# Generated by generate_llm_code.py
# LLM: claude
# Mode: autonomous

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.pipeline import Pipeline
from sklearn.metrics import accuracy_score

# Robust CSV loading
DATASET_PATH = "heart.csv"

df = None
for sep, decimal in [(',', '.'), (';', ','), ('\t', '.'), (' ', '.')]:
    try:
        df_try = pd.read_csv(DATASET_PATH, sep=sep, decimal=decimal)
        if df_try.shape[1] > 1:
            df = df_try
            break
    except Exception:
        continue

if df is None or df.shape[1] <= 1:
    df = pd.read_csv(DATASET_PATH, sep=None, engine='python')

# Strip and normalize column names
df.columns = [str(c).strip() for c in df.columns]
df.columns = [' '.join(c.split()) for c in df.columns]
df = df[[c for c in df.columns if not c.startswith('Unnamed')]]

# The dataset headers suggest space-separated values with no header row
# Headers: 70.0 1.0 4.0 130.0 322.0 0.0 2.0 109.0 0.0 2.4 2.0 3.0 3.0 2
# This matches the classic UCI Heart Disease dataset with 13 features + 1 target (num)
# If columns look like numeric values (no proper names), reload without header

all_cols_look_numeric = True
for c in df.columns:
    try:
        float(c)
    except ValueError:
        all_cols_look_numeric = False
        break

if all_cols_look_numeric:
    # Reload with proper column names
    # Standard UCI heart disease columns:
    proper_columns = ['age', 'sex', 'cp', 'trestbps', 'chol', 'fbs',
                      'restecg', 'thalach', 'exang', 'oldpeak', 'slope',
                      'ca', 'thal', 'target']
    # Try reloading with various separators
    for sep in [',', ';', ' ', '\t']:
        try:
            df_try = pd.read_csv(DATASET_PATH, sep=sep, header=None)
            if df_try.shape[1] == len(proper_columns):
                df = df_try
                df.columns = proper_columns
                break
            elif df_try.shape[1] == len(proper_columns) - 1:
                # Maybe no target or different count
                df = df_try
                df.columns = proper_columns[:df_try.shape[1]]
                break
        except Exception:
            continue
    else:
        # If nothing matched perfectly, use the best attempt
        if df.shape[1] == len(proper_columns):
            df.columns = proper_columns
        else:
            df.columns = [f'col_{i}' for i in range(df.shape[1])]

# Coerce all columns to numeric
for c in df.columns:
    df[c] = pd.to_numeric(df[c], errors='coerce')

# Drop rows with all NaN
df.dropna(how='all', inplace=True)

# Handle inf values
df.replace([np.inf, -np.inf], np.nan, inplace=True)

# Identify target column
target_col = None
if 'target' in df.columns:
    target_col = 'target'
elif 'num' in df.columns:
    target_col = 'num'
else:
    # Use last column as target
    target_col = df.columns[-1]

# For UCI heart disease, target can be 0-4; convert to binary classification (0 vs >=1)
if df[target_col].nunique() > 2:
    df[target_col] = (df[target_col]