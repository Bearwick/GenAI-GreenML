# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: assisted

import os
import pickle
import random
from typing import Optional, Tuple

import numpy as np
import pandas as pd
from sklearn import metrics
from sklearn import svm


SEED = 0


def _set_reproducible(seed: int = SEED) -> None:
    os.environ.setdefault("PYTHONHASHSEED", str(seed))
    random.seed(seed)
    np.random.seed(seed)


def _read_csv_robust(path: str) -> pd.DataFrame:
    df = pd.read_csv(path)
    if df.shape[1] <= 1:
        df = pd.read_csv(path, sep=";", decimal=",")
    return df


def _coerce_numeric_matrix(df: pd.DataFrame) -> np.ndarray:
    arr = df.to_numpy(dtype=np.float64, copy=False)
    return np.ascontiguousarray(arr, dtype=np.float64)


def _load_model(path: str = "dict.pickle") -> svm.SVC:
    with open(path, "rb") as f:
        model = pickle.load(f)
    return model


def _load_input_features(path: str = "input.csv") -> np.ndarray:
    df = _read_csv_robust(path)
    x = _coerce_numeric_matrix(df)
    if x.ndim == 1:
        x = x.reshape(1, -1)
    return x


def _load_supervised_xy(path: str) -> Tuple[np.ndarray, np.ndarray]:
    df = _read_csv_robust(path)
    x = _coerce_numeric_matrix(df.iloc[:, :-1])
    y_raw = df.iloc[:, -1].to_numpy(dtype=np.float64, copy=False)
    y = np.sign(y_raw)
    y[y > 0] = 1
    y[y < 0] = -1
    y = y.astype(np.float64, copy=False)
    return x, y


def _train_test_accuracy(csv_path: str = "14k.csv") -> float:
    x, y = _load_supervised_xy(csv_path)
    n = x.shape[0]
    rng = np.random.RandomState(SEED)
    idx = np.arange(n)
    rng.shuffle(idx)

    test_size = int(round(n * 0.3))
    test_idx = idx[:test_size]
    train_idx = idx[test_size:]

    x_train = x[train_idx]
    y_train = y[train_idx]
    x_test = x[test_idx]
    y_test = y[test_idx]

    clf = svm.SVC(kernel="linear")
    clf.fit(x_train, y_train)
    pred = clf.predict(x_test)
    return float(metrics.accuracy_score(y_test, pred))


def main() -> None:
    _set_reproducible(SEED)

    clf = _load_model("dict.pickle")
    x_pred = _load_input_features("input.csv")
    _ = clf.predict(x_pred)

    accuracy = _train_test_accuracy("14k.csv")
    print(f"ACCURACY={accuracy:.6f}")


if __name__ == "__main__":
    main()

# Optimization Summary
# - Replaced manual csv.reader loops with pandas parsing to reduce Python-level iteration overhead and speed up I/O.
# - Implemented robust CSV parsing fallback (default, then sep=';' and decimal=',') to avoid repeated failed reads.
# - Converted data to contiguous NumPy float64 arrays once to minimize repeated conversions and data movement.
# - Vectorized label processing using np.sign and boolean indexing to avoid per-row branching.
# - Removed global mutable lists and side-effect-heavy functions to reduce memory footprint and improve locality.
# - Ensured reproducibility via fixed seeds and deterministic shuffling for the train/test split.
# - Avoided unnecessary model saving and all non-required prints/plots; kept only final accuracy print as required.