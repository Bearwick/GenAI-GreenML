# Generated by generate_llm_code.py
# LLM: claude
# Mode: autonomous

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

# --- Robust CSV loading ---
DATASET_PATH = "heart.csv"

try:
    df = pd.read_csv(DATASET_PATH)
except Exception:
    df = pd.DataFrame()

# Check if parsing produced a single column (possible separator issue)
if df.shape[1] <= 1:
    try:
        df = pd.read_csv(DATASET_PATH, sep=';', decimal=',')
    except Exception:
        pass

# If still single column, try whitespace separator (headers suggest space-separated)
if df.shape[1] <= 1:
    try:
        df = pd.read_csv(DATASET_PATH, sep=r'\s+')
    except Exception:
        pass

# --- Column name normalization ---
df.columns = [str(c).strip() for c in df.columns]
df.columns = [' '.join(c.split()) for c in df.columns]
# Drop unnamed columns
df = df[[c for c in df.columns if not c.lower().startswith('unnamed')]]

# --- Schema detection ---
# The dataset headers from the prompt look like they are the first data row used as headers
# (space-separated values: 70.0 1.0 4.0 130.0 322.0 0.0 2.0 109.0 0.0 2.4 2.0 3.0 3.0 2)
# This is the classic UCI Heart Disease dataset with 14 attributes.
# Standard column names for this dataset:
STANDARD_COLS = ['age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'restecg',
                 'thalach', 'exang', 'oldpeak', 'slope', 'ca', 'thal', 'target']

# Check if the current column names look like numeric values (i.e., header row is actually data)
all_numeric_headers = True
for c in df.columns:
    try:
        float(c)
    except ValueError:
        all_numeric_headers = False
        break

if all_numeric_headers and len(df.columns) == 14:
    # The header row is actually a data row; re-read with no header
    first_row_values = [float(c) for c in df.columns]
    df.columns = STANDARD_COLS
    # Prepend the header row as data
    header_row = pd.DataFrame([first_row_values], columns=STANDARD_COLS)
    df = pd.concat([header_row, df], ignore_index=True)
elif all_numeric_headers and len(df.columns) != 14:
    # Still assign generic names
    generic_names = [f'col_{i}' for i in range(len(df.columns))]
    first_row_values = [float(c) for c in df.columns]
    df.columns = generic_names
    header_row = pd.DataFrame([first_row_values], columns=generic_names)
    df = pd.concat([header_row, df], ignore_index=True)

# --- Coerce all columns to numeric ---
for c in df.columns:
    df[c] = pd.to_numeric(df[c], errors='coerce')

# Drop rows/cols that are all NaN
df = df.dropna(axis=1, how='all')
df = df.dropna(axis=0, how='all')

# --- Determine target column ---
# Prefer 'target' if it exists; otherwise use last column
if 'target' in df.columns:
    target_col = 'target'
else:
    target_col = df.columns[-1]

# Feature columns: everything except target
feature_cols = [c for c in df.columns if c != target_col]

# Drop rows with NaN in target
df = df.dropna(