# Generated by generate_llm_code.py
# LLM: codex
# Mode: assisted

import pandas as pd
import numpy as np
import random
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler, LabelEncoder
from sklearn.pipeline import Pipeline
from sklearn.svm import SVC
from sklearn.metrics import accuracy_score

DATASET_PATH = "Iris.csv"
DATASET_HEADERS = "Id,SepalLengthCm,SepalWidthCm,PetalLengthCm,PetalWidthCm,Species"

EXPECTED_HEADERS = [h.strip() for h in DATASET_HEADERS.split(",") if h.strip()]
ID_HEADER = EXPECTED_HEADERS[0] if EXPECTED_HEADERS else "Id"
TARGET_HEADER = EXPECTED_HEADERS[-1] if EXPECTED_HEADERS else "Species"

def _is_valid(df):
    cols = [c.strip().lower() for c in df.columns]
    if len(cols) < 5 or len(cols) == 1:
        return False
    return TARGET_HEADER.strip().lower() in cols

def _read_csv_with_fallback(path):
    df = pd.read_csv(path)
    if not _is_valid(df):
        df = pd.read_csv(path, sep=";", decimal=",")
    df.columns = [c.strip() for c in df.columns]
    return df

def _match_column(expected, columns):
    expected_lower = expected.strip().lower()
    for col in columns:
        if col.strip().lower() == expected_lower:
            return col
    return None

def main():
    np.random.seed(42)
    random.seed(42)

    df = _read_csv_with_fallback(DATASET_PATH)

    id_col = _match_column(ID_HEADER, df.columns)
    if id_col is not None:
        df.drop(columns=[id_col], inplace=True)

    target_col = _match_column(TARGET_HEADER, df.columns)
    if target_col is None:
        raise ValueError("Target column not found")

    label_encoder = LabelEncoder()
    df[target_col] = label_encoder.fit_transform(df[target_col])

    feature_cols = [col for col in df.columns if col != target_col]
    X = df[feature_cols]
    y = df[target_col]

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, random_state=42, stratify=y
    )

    pipeline = Pipeline([
        ("scaler", StandardScaler()),
        ("model", SVC(kernel="linear"))
    ])

    pipeline.fit(X_train, y_train)
    y_pred = pipeline.predict(X_test)

    accuracy = accuracy_score(y_test, y_pred)
    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    main()

# Optimization Summary
# - Removed visualization/reporting steps and unused imports to reduce overhead.
# - Dropped cross-validation computation since it did not affect required output.
# - Used in-place column removal and minimal feature selection to limit copies.
# - Added robust CSV parsing with delimiter/decimal fallback and column normalization.
# - Fixed random seeds for deterministic, reproducible results.