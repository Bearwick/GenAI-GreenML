# Generated by generate_llm_code.py
# LLM: codex
# Mode: assisted

import pandas as pd
import numpy as np
import random
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.naive_bayes import MultinomialNB
from sklearn.metrics import accuracy_score

DATASET_HEADERS = "class,text"
SEED = 42
random.seed(SEED)
np.random.seed(SEED)

EXPECTED_HEADERS = [h.strip().lower() for h in DATASET_HEADERS.split(",") if h.strip()]

def is_parsing_ok(df, expected_headers):
    if df.shape[1] < len(expected_headers):
        return False
    cols = {str(c).strip().lower() for c in df.columns}
    return any(h in cols for h in expected_headers)

def read_csv_with_fallback(path, expected_headers):
    df = pd.read_csv(path)
    if not is_parsing_ok(df, expected_headers):
        df = pd.read_csv(path, sep=";", decimal=",")
    return df

def select_column(df, expected_name, fallback_idx):
    expected = expected_name.lower()
    for col in df.columns:
        if str(col).strip().lower() == expected:
            return col
    if fallback_idx < len(df.columns):
        return df.columns[fallback_idx]
    raise ValueError("Expected column not found")

def load_dataset(path, expected_headers):
    df = read_csv_with_fallback(path, expected_headers)
    label_col = select_column(df, expected_headers[0], 0)
    text_col = select_column(df, expected_headers[1], 1)
    labels = df[label_col].map({"Neg": 0, "Pos": 1})
    try:
        labels = labels.astype("int8", copy=False)
    except ValueError:
        pass
    texts = df[text_col]
    return texts, labels

def main():
    X_train, y_train = load_dataset("movie_review_train.csv", EXPECTED_HEADERS)
    X_test, y_test = load_dataset("movie_review_test.csv", EXPECTED_HEADERS)
    vectorizer = CountVectorizer(stop_words="english", min_df=0.03, max_df=0.8)
    model = MultinomialNB()
    model.fit(vectorizer.fit_transform(X_train), y_train)
    y_pred = model.predict(vectorizer.transform(X_test))
    accuracy = accuracy_score(y_test, y_pred)
    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    main()

# Optimization Summary
# - Centralized CSV loading with delimiter fallback and schema-based column selection to prevent redundant parsing.
# - Removed exploratory computations, extra metrics, probability estimates, and plotting to reduce runtime.
# - Fitted and transformed text directly without keeping large intermediate matrices, lowering memory use.
# - Limited imports to essentials and compacted label dtype when possible while keeping outputs identical.
# - Set fixed random seeds to ensure reproducible results.