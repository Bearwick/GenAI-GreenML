# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: assisted

import os
import random
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import confusion_matrix, accuracy_score


SEED = 42


def set_reproducible_seed(seed: int) -> None:
    random.seed(seed)
    np.random.seed(seed)
    os.environ["PYTHONHASHSEED"] = str(seed)


DATASET_HEADERS = ["User ID", "Gender", "Age", "EstimatedSalary", "Purchased"]


def read_csv_robust(path: str, expected_headers: list[str]) -> pd.DataFrame:
    df = pd.read_csv(path)
    if (df.shape[1] < 2) or (df.columns.tolist() == [";".join(expected_headers)]) or (
        df.shape[1] == 1 and df.columns.size == 1
    ):
        df = pd.read_csv(path, sep=";", decimal=",")
    return df


def resolve_columns(df: pd.DataFrame, desired: list[str]) -> dict[str, str]:
    col_map = {c.lower().replace(" ", "").replace("_", ""): c for c in df.columns}
    resolved = {}
    for d in desired:
        key = d.lower().replace(" ", "").replace("_", "")
        if key not in col_map:
            raise KeyError(f"Required column not found: {d}. Available: {list(df.columns)}")
        resolved[d] = col_map[key]
    return resolved


def main() -> None:
    set_reproducible_seed(SEED)

    df = read_csv_robust("Social_Network_Ads.csv", DATASET_HEADERS)
    cols = resolve_columns(df, ["Age", "EstimatedSalary", "Purchased"])

    X = df[[cols["Age"], cols["EstimatedSalary"]]].to_numpy(dtype=np.float32, copy=False)
    y = df[cols["Purchased"]].to_numpy(copy=False)

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.25, random_state=SEED
    )

    scaler = StandardScaler(copy=False)
    X_train = scaler.fit_transform(X_train)
    X_test = scaler.transform(X_test)

    model = LogisticRegression()
    model.fit(X_train, y_train)

    y_pred = model.predict(X_test)

    _cm = confusion_matrix(y_test, y_pred)
    accuracy = accuracy_score(y_test, y_pred)

    print(f"ACCURACY={accuracy:.6f}")


if __name__ == "__main__":
    main()

# Optimization Summary
# - Removed unused heavy imports (matplotlib, seaborn, extra metrics) to reduce import time and memory footprint.
# - Implemented robust CSV parsing with a fallback delimiter/decimal strategy to avoid re-runs and ensure reliable ingestion.
# - Derived required column names from df.columns via normalized matching to avoid hard-coded schema assumptions and reduce failure cases.
# - Converted features to NumPy float32 with copy=False to reduce memory bandwidth and footprint while preserving model behavior.
# - Used StandardScaler(copy=False) to reduce intermediate allocations and unnecessary data movement.
# - Eliminated redundant computations and all non-required printing/visualization; kept only the required final accuracy print.
# - Ensured reproducibility by setting fixed seeds for random, NumPy, and PYTHONHASHSEED.