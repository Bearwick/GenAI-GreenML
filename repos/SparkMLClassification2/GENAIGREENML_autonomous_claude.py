# Generated by generate_llm_code.py
# LLM: claude
# Mode: autonomous

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

# --- Robust CSV Loading ---
DATASET_PATH = "heart.csv"

try:
    df = pd.read_csv(DATASET_PATH)
except Exception:
    df = pd.DataFrame()

# Check if parsing produced reasonable shape; retry with sep=';' and decimal=','
if df.shape[1] < 2:
    try:
        df = pd.read_csv(DATASET_PATH, sep=';', decimal=',')
    except Exception:
        pass

# If still only 1 column, try whitespace separator (headers hint uses spaces)
if df.shape[1] < 2:
    try:
        df = pd.read_csv(DATASET_PATH, sep=r'\s+')
    except Exception:
        pass

# --- Column Name Normalization ---
df.columns = df.columns.astype(str).str.strip()
df.columns = [' '.join(c.split()) for c in df.columns]
# Drop unnamed columns
df = df.loc[:, ~df.columns.str.lower().str.startswith('unnamed')]

# --- Detect if header row is actually data (all numeric column names) ---
# The DATASET_HEADERS hint shows numeric-looking headers like "70.0 1.0 4.0 ..."
# This likely means the CSV has no header row. Check if all column names look numeric.
all_numeric_headers = True
for c in df.columns:
    try:
        float(c)
    except ValueError:
        all_numeric_headers = False
        break

if all_numeric_headers and df.shape[1] >= 2:
    # Reload without header so the first row becomes data, not column names
    try:
        df = pd.read_csv(DATASET_PATH, header=None)
    except Exception:
        pass
    if df.shape[1] < 2:
        try:
            df = pd.read_csv(DATASET_PATH, header=None, sep=r'\s+')
        except Exception:
            pass

    # Assign meaningful names based on common heart-disease dataset convention
    # UCI Heart Disease: age, sex, cp, trestbps, chol, fbs, restecg, thalach,
    #                    exang, oldpeak, slope, ca, thal, target
    heart_col_names = [
        'age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'restecg',
        'thalach', 'exang', 'oldpeak', 'slope', 'ca', 'thal', 'target'
    ]
    if df.shape[1] == len(heart_col_names):
        df.columns = heart_col_names
    else:
        df.columns = [f'col_{i}' for i in range(df.shape[1])]

# --- Coerce all columns to numeric where possible ---
for c in df.columns:
    df[c] = pd.to_numeric(df[c], errors='coerce')

# Drop rows that are entirely NaN
df.dropna(how='all', inplace=True)

# Replace inf with NaN then drop
df.replace([np.inf, -np.inf], np.nan, inplace=True)

# --- Identify target ---
# Prefer a column named 'target' or the last column
target_col = None
if 'target' in df.columns:
    target_col = 'target'
else:
    # Use last column as target
    target_col = df.columns[-1]

# Drop rows where target is NaN
df.dropna(subset=[target_col], inplace=True)

# Feature columns: everything except target
feature_cols = [c for c in df.columns if c != target_col]

# Drop feature columns that are entirely NaN
valid_feature_cols = [c for