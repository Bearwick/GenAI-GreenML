# Generated by generate_llm_code.py
# LLM: claude
# Mode: autonomous

import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.pipeline import Pipeline
from sklearn.metrics import accuracy_score

# --- Robust CSV loading ---
def load_csv(path):
    try:
        df = pd.read_csv(path)
        if df.shape[1] < 2:
            raise ValueError("Too few columns with default sep")
        return df
    except Exception:
        pass
    try:
        df = pd.read_csv(path, sep=';', decimal=',')
        if df.shape[1] < 2:
            raise ValueError("Too few columns with sep=;")
        return df
    except Exception:
        pass
    # Try space-delimited (matches the source code's approach)
    try:
        df = pd.read_csv(path, delim_whitespace=True, header=None)
        return df
    except Exception:
        pass
    df = pd.read_csv(path, header=None)
    return df

df = load_csv('heart.csv')

# The dataset header line provided: "70.0 1.0 4.0 130.0 322.0 0.0 2.0 109.0 0.0 2.4 2.0 3.0 3.0 2"
# This is 14 values, space-delimited, no header row.
# From the source code we know the columns:
expected_cols = [
    'age',
    'sex',
    'chest_pain',
    'resting_blood_pressure',
    'serum_cholesterol',
    'fasting_blood_sugar',
    'resting_ecg',
    'max_heart_rate',
    'exercise_angina',
    'st_depression',
    'slope',
    'num_major_vessels',
    'thal',
    'last'
]

# If the dataframe was loaded without headers and has 14 columns, assign names
if df.shape[1] == len(expected_cols):
    df.columns = expected_cols
elif df.shape[1] == len(expected_cols) - 1:
    # Maybe 'last' is missing
    df.columns = expected_cols[:df.shape[1]]
else:
    # Normalize whatever columns we got
    df.columns = [str(c).strip() for c in df.columns]
    # Drop unnamed columns
    df = df[[c for c in df.columns if not c.lower().startswith('unnamed')]]

# Strip/normalize column names
df.columns = [str(c).strip().replace('  ', ' ') for c in df.columns]

# Coerce all columns to numeric
for c in df.columns:
    df[c] = pd.to_numeric(df[c], errors='coerce')

# Drop rows with NaN/inf
df.replace([np.inf, -np.inf], np.nan, inplace=True)
df.dropna(inplace=True)

assert df.shape[0] > 0, "Dataset is empty after preprocessing"

# --- Construct label ---
# From source code: label is derived from 'thal' column: isSick = 0 if thal in (3,7) else 1
# The original code uses columns 0:13 as data and derives label from 'thal' (column index 12)
if 'thal' in df.columns:
    thal_col = 'thal'
elif df.shape[1] >= 14:
    thal_col = df.columns[12]
else:
    thal_col = None

if thal_col is not None and thal_col in df.columns:
    df['label'] = df[thal_col].apply(lambda x: 0 if x in (3, 7) else 1)
else:
    # Fallback: use last column as target
    df['label'] = df[df.columns[-1]]

# --- Define features ---
# Features are the first 12 columns (