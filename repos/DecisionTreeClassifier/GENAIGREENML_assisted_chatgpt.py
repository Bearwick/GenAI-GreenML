# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: assisted

import pandas as pd
from sklearn.tree import DecisionTreeClassifier
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score

SEED = 42
DATASET_PATH = "music.csv"
DATASET_HEADERS = ["age", "gender", "genre"]


def _read_csv_robust(path: str) -> pd.DataFrame:
    df = pd.read_csv(path)
    if (
        df.shape[1] != len(DATASET_HEADERS)
        or any(col not in df.columns for col in DATASET_HEADERS)
    ):
        df = pd.read_csv(path, sep=";", decimal=",")
    return df


def main() -> None:
    music_data = _read_csv_robust(DATASET_PATH)

    headers_present = [h for h in DATASET_HEADERS if h in music_data.columns]
    target_col = "genre" if "genre" in headers_present else music_data.columns[-1]

    feature_cols = [c for c in music_data.columns if c != target_col]
    X = music_data.loc[:, feature_cols]
    y = music_data.loc[:, target_col]

    X_train, X_test, y_train, y_test = train_test_split(
        X,
        y,
        test_size=0.2,
        random_state=SEED,
        shuffle=True,
        stratify=y if y.nunique(dropna=False) > 1 else None,
    )

    model = DecisionTreeClassifier(random_state=SEED)
    model.fit(X_train, y_train)

    predictions = model.predict(X_test)
    accuracy = accuracy_score(y_test, predictions)
    print(f"ACCURACY={accuracy:.6f}")


if __name__ == "__main__":
    main()

# Optimization Summary
# - Added robust CSV parsing with a fallback delimiter/decimal configuration to avoid mis-parsing and reruns.
# - Set fixed random seeds (train_test_split and DecisionTreeClassifier) for reproducibility and stable results.
# - Used direct column selection via .loc with derived schema to avoid hard assumptions and reduce unnecessary copies.
# - Removed all non-essential outputs and kept only the required final accuracy print to reduce I/O overhead.
# - Enabled stratified splitting when possible to stabilize evaluation without changing the task or expected output type.