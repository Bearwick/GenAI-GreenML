# Generated by generate_llm_code.py
# LLM: gemini
# Mode: original_telemetry

import numpy as np
import csv
from sklearn.model_selection import train_test_split
from sklearn.neighbors import KNeighborsClassifier
from sklearn import metrics

classifier = KNeighborsClassifier(n_neighbors=4)
features = []
labels = []

def makeCSV(inpt):
    try:
        first = True
        with open(inpt, newline='') as csvfile:
            reader = csv.reader(csvfile, delimiter=' ', quotechar='|')
            for row in reader:
                if not row:
                    continue
                cols = row[0].split(",")
                if cols[-1] == '':
                    cols.pop()
                if not first:
                    both = np.asarray(cols, dtype=np.double).tolist()
                    num = both.pop()
                    if num > 0:
                        num = 1
                    elif num < 0:
                        num = -1
                    labels.append(num)
                    features.append(both)
                else:
                    first = False
    except Exception:
        pass

makeCSV('14k.csv')

if len(features) > 0:
    feat_train, feat_test, lab_train, lab_test = train_test_split(
        features, labels, test_size=0.3
    )
    classifier.fit(feat_train, lab_train)
    y_pred = classifier.predict(feat_test)
    accuracy = metrics.accuracy_score(lab_test, y_pred)
    print(f"ACCURACY={accuracy:.6f}")

# OPTIMIZATION SUMMARY
# - Removed unused imports including svm, pickle, copy, and unittest.
# - Consolidated training and evaluation logic from trainAndTestModel into the main execution flow.
# - Removed all original comments, docstrings, and print statements.
# - Excised model persistence logic (saveModel, loadModel) and interactive/inference components (predict, takeInput).
# - Retained the specific CSV parsing logic where rows are split manually by commas after being read as single-token rows.
# - Preserved the original label transformation logic (mapping positive/negative values while leaving zeros).
# - Fixed potential empty row errors in the CSV reader.
# - Added the required formatted accuracy output.