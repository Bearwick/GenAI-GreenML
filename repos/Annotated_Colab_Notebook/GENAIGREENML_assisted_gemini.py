# Generated by generate_llm_code.py
# LLM: gemini
# Mode: assisted

import pandas as pd
from scipy.io import arff
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

def run_pipeline():
    file_path = "dataset_adult.arff"
    try:
        data, _ = arff.loadarff(file_path)
        df = pd.DataFrame(data)
    except:
        try:
            df = pd.read_csv(file_path)
        except:
            df = pd.read_csv(file_path, sep=';', decimal=',')

    obj_cols = df.select_dtypes(include=['object']).columns
    for col in obj_cols:
        if not df[col].empty and isinstance(df[col].iloc[0], bytes):
            df[col] = df[col].str.decode('utf-8')
        df[col] = df[col].astype('category')

    df = pd.get_dummies(df, drop_first=True)

    target_name = 'income_>50K'
    if target_name not in df.columns:
        matching_cols = [c for c in df.columns if '>50K' in c]
        target_name = matching_cols[0] if matching_cols else df.columns[-1]

    X = df.drop(columns=[target_name])
    y = df[target_name]
    del df

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.3, random_state=42
    )

    model = RandomForestClassifier(random_state=42)
    model.fit(X_train, y_train)

    accuracy = accuracy_score(y_test, model.predict(X_test))
    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    run_pipeline()

# Optimization Summary
# 1. Reduced memory footprint by converting object columns to the 'category' dtype before one-hot encoding.
# 2. Optimized runtime by removing redundant classification reports and logging that require additional computation.
# 3. Implemented manual memory management by deleting the original dataframe after extracting features and targets.
# 4. Streamlined preprocessing with a vectorized decoding check for bytes to avoid unnecessary overhead on standard string data.
# 5. Added robust data loading with fallback logic to handle different CSV separators and ARFF formats automatically.
# 6. Minimized data movement by performing column transformations and subsetting in a single pass where possible.
# 7. Preserved original model behavior and reproducibility using a fixed random seed and identical train-test split parameters.