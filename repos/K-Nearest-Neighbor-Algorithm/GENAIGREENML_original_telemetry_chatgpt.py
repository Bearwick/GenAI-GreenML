# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: original_telemetry

import math


def preformat(fileName):
    with open(fileName) as file:
        contents = file.readlines()
        for i in range(len(contents)):
            contents[i] = contents[i][:-1]
            contents[i] = contents[i].split(",")

        for i in range(1, len(contents)):
            for j in range(len(contents[i])):
                contents[i][j] = int(contents[i][j])

    return contents


def getDistance(x1, x2):
    distance = 0
    for i in range(1, len(x1)):
        distance += math.pow((x1[i] - x2[i]), 2)
    return math.sqrt(distance)


def KNN(trainingData, tup, k):
    neighborDistances = [20000] * k
    neighborClasses = [None] * k

    for data in trainingData:
        if isinstance(data[0], str):
            continue

        distance = getDistance(tup, data)
        if all(i < distance for i in neighborDistances):
            continue
        else:
            del neighborClasses[neighborDistances.index(max(neighborDistances))]
            neighborClasses.append(data[0])
            neighborDistances.remove(max(neighborDistances))
            neighborDistances.append(distance)

    classVotes = {}
    for i in range(len(neighborClasses)):
        if neighborClasses[i] not in classVotes.keys():
            classVotes[neighborClasses[i]] = (1 / neighborDistances[i])
        else:
            classVotes[neighborClasses[i]] += (1 / neighborDistances[i])

    for cj, weight in classVotes.items():
        if weight == max(classVotes.values()):
            return cj


def main():
    trainingFileName = "MNIST_train.csv"
    trainingData = preformat(trainingFileName)

    testFileName = "MNIST_test.csv"
    testData = preformat(testFileName)

    k = 7

    desiredClasses = []
    computedClasses = []

    for test in testData:
        if isinstance(test[0], str):
            continue

        desiredClasses.append(test[0])
        computedClasses.append(KNN(trainingData, test, k))

    correctClassifications = 0
    totalClassifications = 0
    for i in range(len(desiredClasses)):
        totalClassifications += 1
        if desiredClasses[i] == computedClasses[i]:
            correctClassifications += 1

    accuracy = (correctClassifications / totalClassifications) * 100
    print(f"ACCURACY={accuracy:.6f}")


if __name__ == "__main__":
    main()