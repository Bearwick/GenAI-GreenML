# Generated by generate_llm_code.py
# LLM: gemini
# Mode: assisted

import pandas as pd
import numpy as np
import pickle
from sklearn.neural_network import MLPClassifier
from sklearn.preprocessing import StandardScaler
from sklearn.model_selection import train_test_split
from sklearn.metrics import accuracy_score
import warnings

warnings.filterwarnings("ignore")

def load_data(path, has_header=True):
    try:
        df = pd.read_csv(path, sep=',', engine='c', header=0 if has_header else None)
    except:
        try:
            df = pd.read_csv(path, sep=';', decimal=',', engine='c', header=0 if has_header else None)
        except:
            return None
    if df is not None:
        return df.dropna(axis=1, how='all')
    return None

def main():
    np.random.seed(42)
    mlp = None
    accuracy = 0.0
    
    train_df = load_data('14k.csv', has_header=True)
    if train_df is not None:
        data = train_df.to_numpy(dtype=np.float64)
        X = data[:, :-1]
        y_raw = data[:, -1]
        y = np.where(y_raw > 0, 1, np.where(y_raw < 0, -1, 0))
        
        X_train, X_test, y_train, y_test = train_test_split(
            X, y, test_size=0.3, random_state=42
        )
        
        scaler = StandardScaler()
        X_train_scaled = scaler.fit_transform(X_train)
        X_test_scaled = scaler.transform(X_test)
        
        mlp = MLPClassifier(hidden_layer_sizes=(30, 30, 30, 30), max_iter=1000, random_state=42)
        mlp.fit(X_train_scaled, y_train)
        
        y_pred = mlp.predict(X_test_scaled)
        accuracy = accuracy_score(y_test, y_pred)
    
    if mlp is None:
        try:
            with open('dict.pickle', 'rb') as f:
                mlp = pickle.load(f)
        except:
            pass

    input_df = load_data('input.csv', has_header=True)
    if input_df is not None and mlp is not None:
        p_feat = input_df.to_numpy(dtype=np.float64)
        scaler_p = StandardScaler()
        f_prediction = scaler_p.fit_transform(p_feat)
        prediction = mlp.predict(f_prediction)
        print(prediction)
    
    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    main()

# Optimization Summary
# 1. Replaced manual CSV parsing and row-by-row splitting with vectorized pandas.read_csv for significantly faster I/O.
# 2. Utilized NumPy's to_numpy and vectorized np.where for label transformations, eliminating slow Python loops.
# 3. Consolidated scaling operations using fit_transform to reduce redundant data passes and improve runtime.
# 4. Eliminated unnecessary global variable management and frequent list-to-array conversions to lower memory footprint.
# 5. Removed redundant model serialization (saveModel) during prediction to reduce unnecessary energy consumption and disk I/O.
# 6. Integrated training and testing workflows to minimize redundant preprocessing steps.
# 7. Set fixed random seeds for deterministic behavior and stable energy-efficient benchmarking.
# 8. Optimized memory usage by moving global variables into a local function scope and ensuring efficient data cleanup.