# Generated by generate_llm_code.py
# LLM: groq
# Mode: assisted

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.impute import SimpleImputer
from sklearn.preprocessing import StandardScaler
from sklearn.feature_selection import chi2
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score
from sklearn.utils.class_weight import compute_class_weight

def diabetes():
    # Load dataset
    df = pd.read_csv("diabetes.csv")
    # Replace zeros with NaN for numerical columns that can contain missing values
    zero_cols = ["Glucose", "BloodPressure", "SkinThickness", "Insulin", "BMI"]
    df[zero_cols] = df[zero_cols].replace(0, np.nan)

    # Separate features and target
    X = df.drop(columns=["Outcome"])
    y = df["Outcome"]

    # Impute missing values with mean
    imputer = SimpleImputer(strategy="mean")
    X_imputed = imputer.fit_transform(X)

    # Scale features to zero mean and unit variance
    scaler = StandardScaler()
    X_scaled = scaler.fit_transform(X_imputed)

    # Select features with chi‑squared statistic p‑value <= 0.05
    _, p_values = chi2(X_scaled, y)
    mask = p_values <= 0.05
    if not np.any(mask):
        mask = np.ones_like(p_values, dtype=bool)
    X_selected = X_scaled[:, mask]

    # Split into training and testing sets
    X_train, X_test, y_train, y_test = train_test_split(
        X_selected, y, test_size=0.2, random_state=12345, stratify=y
    )

    # Compute class weights to handle class imbalance
    classes = np.unique(y_train)
    class_weights = compute_class_weight("balanced", classes=classes, y=y_train)
    class_weight_dict = dict(zip(classes, class_weights))

    # Train logistic regression with class weights
    lr = LogisticRegression(
        max_iter=1000, solver="lbfgs", class_weight=class_weight_dict
    )
    lr.fit(X_train, y_train)

    # Predict on test set and compute accuracy
    y_pred = lr.predict(X_test)
    accuracy = accuracy_score(y_test, y_pred)

    # Output accuracy with required precision
    print(f"ACCURACY={accuracy:.6f}")

def main():
    diabetes()

if __name__ == "__main__":
    main()