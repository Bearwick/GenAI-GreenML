# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: assisted

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score


def load_and_prepare_data(csv_path: str) -> pd.DataFrame:
    df = pd.read_csv(csv_path, usecols=["Category", "Message"])
    df = df.fillna("")
    df["Category"] = df["Category"].map({"spam": 0, "ham": 1}).astype("int8")
    return df


def train_and_evaluate(df: pd.DataFrame, random_state: int = 3) -> float:
    X = df["Message"]
    y = df["Category"]

    X_train, X_test, y_train, y_test = train_test_split(
        X, y, test_size=0.2, random_state=random_state
    )

    vectorizer = TfidfVectorizer(min_df=1, stop_words="english", lowercase=True)
    X_train_features = vectorizer.fit_transform(X_train)
    X_test_features = vectorizer.transform(X_test)

    model = LogisticRegression(solver="liblinear", random_state=random_state)
    model.fit(X_train_features, y_train)

    y_pred = model.predict(X_test_features)
    return accuracy_score(y_test, y_pred)


def main() -> None:
    df = load_and_prepare_data("mail_data.csv")
    accuracy = train_and_evaluate(df, random_state=3)
    print(f"ACCURACY={accuracy:.6f}")


if __name__ == "__main__":
    main()

# OPTIMIZATION SUMMARY
# - Limited CSV read to required columns (usecols) to reduce I/O and memory footprint.
# - Replaced where(pd.notnull(...)) with fillna("") for a single-pass, simpler null handling.
# - Stored labels as int8 instead of int64 to reduce memory usage without changing semantics.
# - Removed redundant imports, prints, head/shape calls, and the standalone predictive demo to avoid unnecessary computation.
# - Used a deterministic, lightweight solver (liblinear) with fixed random_state for reproducible results and efficient training on sparse TF-IDF.
# - Avoided extra intermediate conversions (y already numeric) and computed only the required test accuracy.