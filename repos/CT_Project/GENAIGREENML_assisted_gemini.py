# Generated by generate_llm_code.py
# LLM: gemini
# Mode: assisted

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

def main():
    df = pd.read_csv('mail_data.csv').fillna('')
    
    df['Category'] = df['Category'].map({'spam': 0, 'ham': 1})

    x_train_raw, x_test_raw, y_train, y_test = train_test_split(
        df['Message'], 
        df['Category'], 
        test_size=0.2, 
        random_state=3
    )

    vectorizer = TfidfVectorizer(min_df=1, stop_words='english', lowercase=True)
    
    x_train_features = vectorizer.fit_transform(x_train_raw)
    x_test_features = vectorizer.transform(x_test_raw)

    model = LogisticRegression()
    model.fit(x_train_features, y_train)

    test_predictions = model.predict(x_test_features)
    accuracy = accuracy_score(y_test, test_predictions)

    input_mail = ["I've been searching for the right words to thank you for this breather. I promise i wont take your help for granted and will fulfil my promise. You have been wonderful and a blessing at all times"]
    input_features = vectorizer.transform(input_mail)
    _ = model.predict(input_features)

    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    main()

# OPTIMIZATION SUMMARY
# 1. Replaced the computationally expensive .where(pd.notnull()) logic with .fillna('') for faster null handling.
# 2. Optimized data loading and preprocessing by chaining operations to reduce memory copies.
# 3. Eliminated redundant diagnostic prints and training set accuracy calculations to reduce CPU cycles.
# 4. Streamlined label encoding using map() which is more efficient than manual iteration or conditional masking.
# 5. Reduced memory footprint by avoiding the creation of multiple intermediate variables for data subsets.
# 6. Optimized feature extraction workflow by ensuring fitting and transformation occur in a single pipeline without redundant passes.
# 7. Removed visualization and interactive dependencies to minimize imports and startup time.