# Generated by generate_llm_code.py
# LLM: gemini
# Mode: original_telemetry

import numpy as np
import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import confusion_matrix

def confmatrix_of_RandomForest(trainingdata_filepath, testdata_filepath, criterion="entropy"):
    training_data = pd.read_csv(trainingdata_filepath)
    test_data = pd.read_csv(testdata_filepath)

    training_data.drop(['parts {1=akoustiko,2=optiko,3=mousiki}', 'Subject ID'], axis='columns', inplace=True)
    test_data.drop(['parts {1=akoustiko,2=optiko,3=mousiki}', 'Subject ID'], axis='columns', inplace=True)

    training_data.replace(to_replace='CN', value=0, inplace=True)
    training_data.replace(to_replace='DYS', value=1, inplace=True)
    test_data.replace(to_replace='CN', value=0, inplace=True)
    test_data.replace(to_replace='DYS', value=1, inplace=True)

    training_todrop = training_data.columns[training_data.isna().any()].tolist()
    test_todrop = test_data.columns[test_data.isna().any()].tolist()
    exclude_list = list(set(training_todrop + test_todrop))
    
    training_data.drop(exclude_list, axis='columns', inplace=True)
    test_data.drop(exclude_list, axis='columns', inplace=True)

    training_data = training_data.astype(np.float32, copy=False)
    training_data = training_data.astype({'class': np.int32}, copy=False)

    test_data = test_data.astype(np.float32, copy=False)
    test_data = test_data.astype({'class': np.int32}, copy=False)

    y_training = training_data['class']
    x_training = training_data.drop(['class'], axis='columns', inplace=False)

    y_test = test_data['class']
    x_test = test_data.drop(['class'], axis='columns', inplace=False)

    a = np.zeros(shape=(5, 4))
    for x in range(5):
        model = RandomForestClassifier(criterion=criterion, max_depth=8)
        model.fit(x_training, y_training)
        y_pred = model.predict(x_test)
        conf = confusion_matrix(y_test, y_pred, labels=[0, 1])
        array_1d = conf.flatten()
        a[x] = array_1d
    
    conf = np.mean(a, axis=0)
    return conf

if __name__ == '__main__':
    conf = confmatrix_of_RandomForest("entire brain_training_2.csv", "entire brain_test_2.csv")
    accuracy = (conf[0] + conf[3]) / np.sum(conf)
    print(f"ACCURACY={accuracy:.6f}")

# OPTIMIZATION SUMMARY
# - Removed original comments and redundant code such as print statements and file exports.
# - Fixed a potential error by converting the column exclusion set into a list before using the drop method.
# - Cleaned up the mean confusion matrix calculation to use a standard NumPy axis operation.
# - Added a mean accuracy calculation and formatted print based on the resulting confusion matrix.
# - Maintained original model parameters (criterion="entropy", max_depth=8) and data processing steps.