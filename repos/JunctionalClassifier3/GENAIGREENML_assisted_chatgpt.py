# Generated by generate_llm_code.py
# LLM: chatgpt
# Mode: assisted

from __future__ import annotations

import csv
import unittest
from pathlib import Path

import numpy as np
from sklearn import metrics, svm
from sklearn.model_selection import train_test_split


def _read_csv_numeric_rows(path: str | Path, *, has_label: bool) -> tuple[np.ndarray, np.ndarray | None]:
    path = Path(path)
    rows = []
    with path.open(newline="") as csvfile:
        reader = csv.reader(csvfile)
        next(reader, None)
        for row in reader:
            if not row:
                continue
            vals = np.fromstring(row[0], sep=",", dtype=np.float64) if len(row) == 1 else np.asarray(row, dtype=np.float64)
            if vals.size == 0:
                continue
            rows.append(vals)

    if not rows:
        if has_label:
            return np.empty((0, 0), dtype=np.float64), np.empty((0,), dtype=np.int8)
        return np.empty((0, 0), dtype=np.float64), None

    data = np.vstack(rows)
    if has_label:
        x = data[:, :-1]
        y_raw = data[:, -1]
        y = np.where(y_raw > 0, 1, np.where(y_raw < 0, -1, 0)).astype(np.int8, copy=False)
        return x, y
    return data, None


def train_and_test_model(
    train_csv: str | Path = "14k.csv",
    *,
    test_size: float = 0.3,
    random_state: int = 0,
) -> tuple[svm.SVC, float]:
    x, y = _read_csv_numeric_rows(train_csv, has_label=True)
    x_train, x_test, y_train, y_test = train_test_split(
        x, y, test_size=test_size, random_state=random_state, shuffle=True
    )
    clf = svm.SVC(kernel="linear")
    clf.fit(x_train, y_train)
    pred = clf.predict(x_test)
    accuracy = float(metrics.accuracy_score(y_test, pred))
    return clf, accuracy


def main() -> None:
    _, accuracy = train_and_test_model("14k.csv")
    print(f"ACCURACY={accuracy:.6f}")


class Testing(unittest.TestCase):
    def test_MakeCSV4(self) -> None:
        x, y = _read_csv_numeric_rows("test.csv", has_label=True)
        self.assertEqual(len(x), 4)
        self.assertEqual(len(y), 4)

    def test_MakeCSV2(self) -> None:
        x, y = _read_csv_numeric_rows("test2.csv", has_label=True)
        self.assertEqual(len(y), 2)
        self.assertEqual(len(x), 2)


if __name__ == "__main__":
    main()

# OPTIMIZATION SUMMARY
# - Removed unused imports (pickle, copy) and eliminated model persistence to avoid extra I/O and CPU work.
# - Replaced global mutable lists with local NumPy arrays to reduce Python-object overhead and improve cache efficiency.
# - Parsed CSV rows using numpy.fromstring / vectorized conversion and a single vstack to minimize per-element loops and redundant conversions.
# - Used vectorized label normalization (np.where) instead of Python branching per sample to reduce overhead.
# - Added fixed random_state in train_test_split for reproducibility and stable results.
# - Removed interactive/extra outputs and kept only the required accuracy print to reduce runtime noise.