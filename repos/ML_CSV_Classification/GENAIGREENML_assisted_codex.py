# Generated by generate_llm_code.py
# LLM: codex
# Mode: assisted

import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split, cross_val_score
from sklearn.preprocessing import StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score

RANDOM_STATE = 42

def set_seed(seed):
    np.random.seed(seed)

def read_csv_robust(file_path):
    df = pd.read_csv(file_path)
    if df.shape[1] == 1:
        df_alt = pd.read_csv(file_path, sep=';', decimal=',')
        if df_alt.shape[1] > 1:
            df = df_alt
    return df

def align_headers(df):
    headers = globals().get("DATASET_HEADERS", None)
    if headers is not None:
        if isinstance(headers, str):
            headers = [h.strip() for h in headers.split(",") if h.strip()]
        if isinstance(headers, (list, tuple, np.ndarray)) and len(headers) == df.shape[1]:
            df.columns = list(headers)
    return df

def load_data(file_path):
    df = align_headers(read_csv_robust(file_path))
    if df.shape[1] < 2:
        raise ValueError("Dataset must contain at least two columns.")
    X = df.iloc[:, :-1].to_numpy()
    y = df.iloc[:, -1].to_numpy()
    return X, y

def preprocess_data(X):
    scaler = StandardScaler(copy=False)
    return scaler.fit_transform(X)

def build_model():
    return RandomForestClassifier(
        n_estimators=100,
        class_weight="balanced",
        random_state=RANDOM_STATE,
        n_jobs=1
    )

def cross_validate_model(X, y):
    model = build_model()
    return cross_val_score(model, X, y, cv=5)

def train_model(X_train, y_train):
    model = build_model()
    model.fit(X_train, y_train)
    return model

def evaluate_model(model, X_test, y_test):
    y_pred = model.predict(X_test)
    return accuracy_score(y_test, y_pred)

def main():
    set_seed(RANDOM_STATE)
    file_path = "grafici.csv"
    X, y = load_data(file_path)
    X_scaled = preprocess_data(X)
    _ = cross_validate_model(X_scaled, y)
    X_train, X_test, y_train, y_test = train_test_split(
        X_scaled, y, test_size=0.2, random_state=RANDOM_STATE
    )
    model = train_model(X_train, y_train)
    accuracy = evaluate_model(model, X_test, y_test)
    print(f"ACCURACY={accuracy:.6f}")

if __name__ == "__main__":
    main()

# Optimization Summary
# Removed plotting, model saving, and verbose reporting to eliminate unnecessary I/O and computation.
# Centralized model configuration and scaled data once with in-place capable settings to reduce redundant work and memory use.
# Added robust CSV parsing with delimiter fallback and header alignment for reliable ingestion.
# Fixed random seeds and consolidated workflow steps for deterministic, reproducible execution.