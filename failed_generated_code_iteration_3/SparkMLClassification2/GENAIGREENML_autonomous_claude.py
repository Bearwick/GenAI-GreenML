# Generated by generate_llm_code.py
# LLM: claude
# Mode: autonomous

import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.metrics import accuracy_score

DATASET_PATH = "heart.csv"

# Robust CSV loading with fallback
df = None
for sep, decimal in [(',', '.'), (';', ','), (' ', '.'), ('\t', '.')]:
    try:
        df_try = pd.read_csv(DATASET_PATH, sep=sep, decimal=decimal)
        if df_try.shape[1] > 1:
            df = df_try
            break
    except Exception:
        continue

if df is None or df.shape[1] <= 1:
    df = pd.read_csv(DATASET_PATH, sep=None, engine='python')

# Strip/normalize column names
df.columns = [str(c).strip() for c in df.columns]
df.columns = [' '.join(c.split()) for c in df.columns]
df = df[[c for c in df.columns if not c.startswith('Unnamed')]]

# Based on the DATASET_HEADERS, it looks like the file may have no header row
# and columns correspond to UCI Heart Disease features:
# age, sex, cp, trestbps, chol, fbs, restecg, thalach, exang, oldpeak, slope, ca, thal, target
# The header line "70.0 1.0 4.0 130.0 322.0 0.0 2.0 109.0 0.0 2.4 2.0 3.0 3.0 2" suggests
# the first row is data, not headers. Let's detect this.

expected_col_names = ['age', 'sex', 'cp', 'trestbps', 'chol', 'fbs', 'restecg',
                      'thalach', 'exang', 'oldpeak', 'slope', 'ca', 'thal', 'target']

# Check if the current columns look like numbers (no header scenario)
all_numeric_cols = True
for c in df.columns:
    try:
        float(c)
    except (ValueError, TypeError):
        all_numeric_cols = False
        break

if all_numeric_cols and df.shape[1] == 14:
    # Re-read without header
    for sep, decimal in [(',', '.'), (';', ','), (' ', '.'), ('\t', '.')]:
        try:
            df_try = pd.read_csv(DATASET_PATH, sep=sep, decimal=decimal, header=None)
            if df_try.shape[1] == 14:
                df = df_try
                df.columns = expected_col_names
                break
        except Exception:
            continue
elif all_numeric_cols and df.shape[1] != 14:
    # Try space-separated with no header
    try:
        df_try = pd.read_csv(DATASET_PATH, sep=r'\s+', header=None, engine='python')
        if df_try.shape[1] == 14:
            df = df_try
            df.columns = expected_col_names
    except Exception:
        pass

# If columns match known UCI heart names, use them; otherwise derive
if 'target' in df.columns:
    target_col = 'target'
elif 'num' in df.columns:
    target_col = 'num'
else:
    # Use last column as target
    target_col = df.columns[-1]

# Coerce all columns to numeric
for c in df.columns:
    df[c] = pd.to_numeric(df[c], errors='coerce')

# Drop rows with NaN in target
df = df.dropna(subset=[target_col])

# For heart disease: target > 0 means disease present; binarize if needed
unique_targets = df[target_col].unique()
if len(unique_targets) > 2:
    #